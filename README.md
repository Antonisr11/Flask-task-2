# 2η Υποχρεωτική Εργασία Πληροφοριακά Συστήματα

## Περιεχόμενα 
* [Γενικά](#General)
* [Δημιουργία χρήστη](#Create_User) 
* [Αυθεντικοποίηση / Login](#Authentication/Login)
* [Αναζήτηση](#Search)
* [Προσθήκη προϊόντων στο καλάθι](#Add_cart)
* [Εμφάνιση καλαθιού](#Show_cart)
* [Αφαίρεση προϊόντος από το καλάθι](#Remove_cart)
* [Αγορά των προϊόντων στο καλάθι](#Buy)
* [Προβολή ιστορικού](#Show_history)
* [Διαγραφή χρήστη](#Delete_account)
* [Δημιουργία προϊόντος](#Create_product)
* [Διαγραφή προϊόντος](#Delete_product)
* [Ενημέρωση προϊόντος](#Update_product)

## General
Το προγραμμά διαχειρίζεται μέσω flask μία βάση δεδομένων που κρατάει στοιχεία για ένα σούπερ μάρκετ. Η βάση δεδομένων υλοποιείται μέσω της MongoDB.
######
Παρακάτω θα δούμε σε γενικές γραμμές πως λειτουργεί το πρόγραμμα. Για περισσότερες τεχνικές λεπτομέρειες, υπάρχουν πολλά σχόλια στον κώδικα.

## Create_User
Το endpoint αυτό καλείται με τη μέθοδο __POST__.
######
Αρχικά ελέγχουμε για το αν το request έχει τα απαραίτητα πεδία. Θα το εξηγήσουμε εδώ με ποιον τρόπο γίνεται και δεν θα το αναλύσουμε στα υπόλοιπα endpoints αφού χρησιμοποιούμε την ίδια μέθοδο.
######
Για να ελέγξουμε αν το request έχει τα στοιχεία που χρειαζόμαστε, καλείται η συνάρτηση has_required_fields με όρισμα μια λίστα από string που είναι τα ονόματα των fields που πρέπει να περιέχονται στο request, και το data δηλαδή τα δεδομένα από το request. Μέσα στην συνάρτηση has_required_fields τρέχει ένα loop που ελέγχει αν το request εμπεριέχει τα string ονόματα ως fields.
>Η συνάρτηση επιστρέφει True αν όλα τα fields εμπεριέχονται στο request, δηλαδή αν δεν λείπει κάποιο στοιχείο.
######
>Η συνάρτηση επιστρέφει False αν λείπει τουλάχιστον ένα πεδίο από το request. 
######
Αφού ελέγξουμε ότι έχουμε όσα πεδία απαιτούνται (συγκεκριμένα email, όνομα και κωδικό) ελέγχουμε αν υπάρχει άλλος χρήστης με αυτό το email. Αν υπάρχει εμφανίζεται ένα ανάλογο μήνυμα, αν δεν υπάρχει γίνεται εισαγωγή και εμφανίζεται μήνυμα επιτυχίας.


## Authentication/Login
Η αυθεντικοποίηση του χρήστη έγινε __σχεδόν__ με τον ίδιο τρόπο με την 1η εργασία. Η διαδικασία είναι η εξής:
1. Ο χρήστης κάνει ένα post request στο login με το email του και με τον κωδικό του.
2. Γίνεται έλεγχος αν υπάρχει λογαριασμός με αυτά τα στοιχεία. Αν δεν υπάρχει εμφανίζεται μήνυμα λάθους.
3. Αν υπάρχει καλείται η συνάρτηση create_session που προσθέτει στην λίστα users_sessions μια υπό-λίστα με τα εξής 4 στοιχεία:
	1. Τον μοναδικό user_uuid κωδικό.
	2. Το email του χρήστη.
	3. Την ώρα εκείνης της στιγμής.
	4. Tην κατηγορία του χρήστη (Simple για απλό χρήστη, Admin για διαχειριστή).
4. Επιστρέφεται το user_uuid.

Όταν θέλει ο χρήστης να εκτελέσει μια ενέργεια που απαιτεί αυθεντικοποίηση:
1. Καλείται η συνάρτηση is_session_valid.
2. Σαν όρισμα έχουμε το user_uuid του χρήστη και το category __που απαιτεί η ενέργεια αυτή__ (πχ αν η πράξη απαιτεί ο χρήστης να είναι admin το category θα είναι "Admin").
3. Η συνάρτηση επιστρέφει True μόνο αν το user_uuid είναι αποθηκευμένο στην λίστα users_sessions __και__ ο χρήστης έχει τα δικαιώματα (που αναφέρει το category) που απαιτείται. 
	>Πρέπει να σημειώσουμε πως ο Admin έχει και όλα τα δικαιώματα του απλού χρήστη ενώ το αντίστροφο δεν ισχύει. Οπότε αν η πράξη απαιτεί Simple και ο χρήστης είναι Admin, η συνάρτηση θα επιστρέψει True.
4. Σε κάθε άλλη περίπτωση η συνάρτηση θα επιστρέψει False.

## Search
Για την αναζήτηση προϊόντων μέσω αυτής της flask εφαρμογής, έχουμε 3 τρόπους γιαυτό και έχουμε φτιάξει 3 διαφορετικά endpoints:
1. Αναζήτηση βάσει ονόματος
	######
	Το endpoint αυτό καλείται με τη μέθοδο __GET__.
	######
	Αφού ελέγξουμε ότι έχουμε όσα πεδία απαιτούνται (συγκεκριμένα όνομα) και έχουμε αυθεντικοποίησει τον χρήστη, ελέγχουμε αν υπάρχουν προϊόντα με αυτό το όνομα. Αν υπάρχουν τα επιστρέφουμε στον χρήστη, αλλιώς του εμφανίζεται ένα μήνυμα που τον ενημερώνει ότι δεν βρέθηκαν προϊόντα με αυτό το όνομα.
######
2. Αναζήτηση βάσει κατηγορίας
	######
	Το endpoint αυτό καλείται με τη μέθοδο __GET__.
	######
	Αφού ελέγξουμε ότι έχουμε όσα πεδία απαιτούνται (συγκεκριμένα κατηγορία) και έχουμε αυθεντικοποίησει τον χρήστη, ελέγχουμε αν υπάρχουν προϊόντα με αυτή την κατηγορία. Αν υπάρχουν τα επιστρέφουμε στον χρήστη, αλλιώς του εμφανίζεται ένα μήνυμα που τον ενημερώνει ότι δεν βρέθηκαν προϊόντα με αυτή την κατηγορία.
######
3. Αναζήτηση μέσω id
	######
	Το endpoint αυτό καλείται με τη μέθοδο __GET__.
	######
	Αφού ελέγξουμε ότι έχουμε όσα πεδία απαιτούνται (συγκεκριμένα id) και έχουμε αυθεντικοποίησει τον χρήστη, ελέγχουμε αν υπάρχουν προϊόντα με αυτό το id. Αν υπάρχουν τα επιστρέφουμε στον χρήστη, αλλιώς του εμφανίζεται ένα μήνυμα που τον ενημερώνει ότι δεν βρέθηκαν προϊόντα με αυτό το id.
	
## Add_cart
Το endpoint αυτό καλείται με τη μέθοδο __GET__.
######
Αφού ελέγξουμε ότι έχουμε όσα πεδία απαιτούνται (συγκεκριμένα το id του προϊόντος και την ποσότητα) και έχουμε αυθεντικοποίησει τον χρήστη, ελέγχουμε αν υπάρχει κάποιο προϊόν με αυτό το id. Αν δεν υπάρχει εμφανίζεται ένα ανάλογο μήνυμα. Αν υπάρχει προϊόν προχωρούμε στον έλεγχο του stock. Θα πρέπει το stock να είναι μεγαλύτερο ίσο με την ζητούμενη ποσότητα (σε περίπτωση που δεν είναι εμφανίζεται ανάλογο μήνυμα).
######
Αφού έχουν περάσει όλοι οι έλεγχοι επιτυχώς, αποθηκεύονται στην τοπική global μεταβλητή cart_products τα id των προϊόντων, στην cart_total_price η συνολική *μέχρι στιγμής* τιμή και στην cart_items ο συνολικός αριθμός των προϊόντων που είναι μέσα στο καλάθι.
>Να σημειώσουμε *(αν και αναφαίρεται στον κώδικα)*, ότι όταν ο χρήστης επιλέγει n ποσότητα από ένα προϊόν, το προϊόν αυτό προστίθεται n φορές στο καλάθι.
######
Όταν όλα γίνουν επιτυχώς στον χρήστη επιστρέφεται το καλάθι του μαζί με την συνολική *μέχρι στιγμής* τιμή.

## Show_cart
Το endpoint αυτό καλείται με τη μέθοδο __GET__.
######
Σε αυτό το endpoint δεν γίνεται έλεγχος για πεδία καθώς δεν απαιτείται κάποιο για την προβολή του καλαθιού. Αυτό που γίνεται είναι αυθεντικοποίηση του χρήστη και έπειτα ελέγχεται αν το καλάθι είναι κενό.
>Αν είναι κενό εμφανίζεται ανάλογο μήνυμα
######
>Αν δεν είναι, επιστρέφεται μαζί με την συνολική τιμή σε μορφή JSON.

## Remove_cart
Το endpoint αυτό καλείται με τη μέθοδο __GET__.
######
Αφού ελέγξουμε ότι έχουμε όσα πεδία απαιτούνται (συγκεκριμένα το id του προϊόντος) και έχουμε αυθεντικοποίησει τον χρήστη, ελέγχουμε αν υπάρχει το προϊόν αυτό στο καλάθι του χρήστη (αν δεν υπάρχει εμφανίζεται ανάλογο μήνυμα). Αφού βρεθεί, διαγράφεται από το καλάθι και αφαιρείται η αξία του από το συνολικό κόστος. Ακόμα η μετραβλητή που δείχνει τα συνολικά προϊόντα μειώνεται κατά 1.
######
Τέλος επιστρέφεται το καλάθι του χρήστη μαζί με την συνολική τιμή. 

## Buy
Το endpoint αυτό καλείται με τη μέθοδο __GET__.
######
Αφού ελέγξουμε ότι έχουμε όσα πεδία απαιτούνται (συγκεκριμένα το card_number) και έχουμε αυθεντικοποίησει τον χρήστη, ελέγχουμε αν το card_number έχει 16 ψηφία (αν είναι μεγαλύτερο ή μικρότερο από 16 εμφανίζεται ανάλογο μήνυμα). Έπειτα αποθηκεύουμε τα στοιχεία του καλαθιού στο ιστορικό του χρήστη και τέλος του επιστρέφεται μια απόδειξη.
######
Τέλος αδειάζουμε το καλάθι του χρήστη μαζί με την τιμή και τον αριθμό των προϊόντων που βρίσκονται μέσα σε αυτό. 

## Show_history
Το endpoint αυτό καλείται με τη μέθοδο __GET__.
######
Σε αυτό το endpoint δεν γίνεται έλεγχος για πεδία καθώς δεν απαιτείται κάποιο για την προβολή του ιστορικού του χρήστη. Αυτό που γίνεται είναι αυθεντικοποίηση του χρήστη και έπειτα εκτύπωση του ιστορικού του.

## Delete_account
Το endpoint αυτό καλείται με τη μέθοδο __GET__.
######
Σε αυτό το endpoint δεν γίνεται έλεγχος για πεδία καθώς δεν απαιτείται κάποιο για την διαγραφή του χρήστη. Αυτό που γίνεται είναι αυθεντικοποίηση του χρήστη και έπειτα η διαγραφή του από την βάση δεδομένων.
######
Τέλος διαγράφουμε από τον πίνακα με τα αποθηκευμένα sesssions όλα αυτά που αφορούν τον συγκεκριμένο χρήστη ώστε να μην έχει πλέον πρόσβαση.

## Create_product
Το endpoint αυτό καλείται με τη μέθοδο __GET__.
######
Αφού ελέγξουμε ότι έχουμε όσα πεδία απαιτούνται (συγκεκριμένα όνομα, τιμή, περιγραφή, stock) και έχουμε αυθεντικοποίησει τον χρήστη (πρέπει **υποχρεωτικά** να έχει δικαιώματα admin), γίνεται η εισαγωγή του προϊόντος στην βάση δεδομένων.

## Delete_product
Το endpoint αυτό καλείται με τη μέθοδο __GET__.
######
Αφού ελέγξουμε ότι έχουμε όσα πεδία απαιτούνται (συγκεκριμένα το id του προϊόντος) και έχουμε αυθεντικοποίησει τον χρήστη (πρέπει **υποχρεωτικά** να έχει δικαιώματα admin), ελέγχουμε αν υπάρχει κάποιο προϊόν με αυτό το id (αν δεν υπάρχει εμφανίζεται ένα αντίστοιχο μήνυμα). 
######
Αφού υπάρχει διαγράφεται από την βάση δεδομένων και επιστρέφεται ένα μήνυμα επιτυχίας.

## Update_product
Το endpoint αυτό καλείται με τη μέθοδο __GET__.
######
Σε αυτό το endpoint κάνουμε έναν διαφορετικό έλεγχο για τα πεδία. Χρειαζόμαστε τουλάχιστον ένα από αυτά (και υποχρεωτικά το id) οπότε δεν καλείται η συνάρτηση has_required_fields. 
######
Αφού ελέγξουμε ότι έχουμε τουλάχιστον ένα από τα πεδία απαιτούνται (συγκεκριμένα το id, όνομα, τιμή, περιγραφή, stock) και έχουμε αυθεντικοποίησει τον χρήστη (πρέπει **υποχρεωτικά** να έχει δικαιώματα admin), ελέγχουμε αν υπάρχει το προϊόν με αυτό το id (αν δεν υπάρχει εμφανίζεται ανάλογο μήνυμα). Αφού βρεθεί, αλλάζουν τα πεδία που έχει εισάγει στο request.
######
Τέλος επιστρέφεται ένα μήνυμα επιτυχίας.
